---
import ProfileButtons from '../ui/ProfileButtons.astro';

const experiences = [
  {
    year: '05/25',
    role: 'Lab 829',
    company: 'Canada/Worldwide',
    period: 'September 2005 - Present',
    position: 'Director of Technology',
    subtitle: 'Formerly Miroamarillo Studio',
    status: { type: 'active', label: 'Active' },
    description: [
      'Partnered with clients worldwide, including leading fintech and retail organizations, to deliver transformative digital solutions tailored to their business needs.',
      'Spearheaded projects such as marketing data-driven personalization initiatives, enrollment wizards for fintech platforms, and the seamless integration of innovative AI-based solutions into existing client infrastructures.',
      'Directed initiatives that reached over 5 million users, significantly enhancing customer retention rates and unlocking over $10 million in new annual revenue streams.',
      'Championed accessibility and inclusive design to strengthen brand-audience connections, fostering trust and loyalty.',
      'Oversaw end-to-end implementation and deployment of digital solutions.',
    ],
    skills: [
      'Global Client Collaboration',
      'AI Integration',
      'Customer Retention Strategies',
      'Revenue Growth',
      'Accessibility Consulting',
      'Market Activation Strategies',
      'Solution Deployment',
    ],
    impact: [
      '5M+ Users Reached',
      '$10M+ Revenue Generated',
      'Multiple Global Markets',
      'Enhanced Customer Retention',
    ],
    imageUrl: '/images/lab829.jpg',
  },
  {
    year: '21/22',
    role: 'Critical Mass',
    company: 'Canada/UK/Central America/US',
    period: 'July 2021 - June 2022',
    position: 'Director of Technology',
    subtitle: '',
    status: { type: 'previous', label: 'Previous' },
    description: [
      'Directed high-impact personalization and lease renewal projects for Nissan and Infiniti, engaging over 1 million customers and driving brand loyalty.',
      'Led the successful launch of the Nissan Ariya campaign, orchestrating cross-functional teams of 50 members across the UK, Central America, Canada, and the US.',
      'Spearheaded the hiring, onboarding, and retention strategy for new team members, including developing an innovative onboarding platform that reduced onboarding time by 50%.',
      'Partnered with marketing, design, and revenue teams to align customer-focused initiatives with business objectives.',
      'Led product management and innovation initiatives with internal and external stakeholders.',
    ],
    skills: [
      'Front-End Direction',
      'Global Team Leadership',
      'Campaign Management',
      'Customer Personalization',
      'Onboarding Optimization',
      'Cross-Functional Collaboration',
      'Digital Strategy',
      'Revenue Growth',
    ],
    impact: [
      '1M+ Customers Engaged',
      '50% Reduced Onboarding Time',
      '50+ Team Members Led',
      'Multiple Global Regions',
    ],
    imageUrl: '/images/criticalmass.png',
  },
  {
    year: '18/19',
    role: 'Deloitte Digital',
    company: 'Canada/US',
    period: 'May 2018 - July 2019',
    position:
      'Director of Front End Engineering, Accessibility Strategy and Digital Integration',
    subtitle: '',
    status: { type: 'previous', label: 'Previous' },
    description: [
      'Directed the launch of PcExpress, a digital platform that reached over 4 million users monthly, driving significant engagement and customer retention.',
      'Led TD Canada Trust personalization initiative designed to connect with over 6 million users across Canada.',
      'Orchestrated marketing campaigns for Loblaws, achieving seasonal outreach to over 2 million users per campaign.',
      'Championed innovation by integrating accessibility strategies into high-profile projects.',
      'Oversaw budgeting and resource allocation for an annual portfolio valued at $2.5 million.',
    ],
    skills: [
      'Campaign Leadership',
      'Personalization Strategy',
      'User Engagement',
      'Accessibility Integration',
      'Budget Management',
      'Digital Platforms',
    ],
    impact: [
      '4M+ Monthly Users',
      '6M+ Canadians Reached',
      '2M+ Campaign Reach',
      '$2.5M Budget Managed',
    ],
    imageUrl: '/images/deloittedigital.png',
  },
  {
    year: '16/18',
    role: 'Royal Bank of Canada',
    company: 'Canada',
    period: 'July 2016 - May 2018',
    position:
      'Director of Front-End Development - Online Banking & Omnichannel',
    subtitle: '',
    status: { type: 'previous', label: 'Previous' },
    description: [
      'Scaled the front-end development team from 2 to 20 members, managing 18 concurrent projects for over 8 million users.',
      'Delivered a strategic front-end roadmap that improved development efficiency, integrating multiple technology platforms.',
      'Reduced accessibility bugs by 90% before the first QA cycle through best practices implementation.',
      'Accelerated product delivery timelines by developing an in-house framework and optimizing processes.',
      'Led cross-functional collaboration to define customer journeys and enhance user experience across desktop and mobile.',
      'Managed a $2.5 million annual budget, optimizing resource allocation and driving product management initiatives.',
    ],
    skills: [
      'Enterprise Strategy',
      'Team Scaling',
      'Accessibility',
      'Platform Integration',
      'Agile Development',
      'Budget Optimization',
    ],
    impact: [
      '8M+ Users Impacted',
      '90% Fewer Accessibility Bugs',
      '18 Concurrent Projects',
      '$2.5M Budget Managed',
    ],
    imageUrl: '/images/rbc.jpg',
  },
];

// LinkedIn URL and resume file path
const linkedInUrl = 'https://linkedin.com/in/julianpinedayyz';
const resumeFilePath = 'public/Julian Pineda - 5v4.pdf';
---

<section id="experience" class="bg-[#1A1A1A] py-10 text-white">
  <div class="max-w-[1480px] mx-auto px-6 my-[40px]">
    <h2 class="h2-heading text-[#DCDCDC]">Experience</h2>

    <ul class="item-list">
      {
        experiences.map((job, index) => (
          <li
            class="list-item"
            tabindex="0"
            aria-expanded={index === 0 ? 'true' : 'false'}
          >
            <div class="item-main">
              <div class="item-year font-extralight italic text-4xl tracking-[-0.08em]">
                {job.year}
              </div>
              <div class="item-model font-semibold text-4xl tracking-[-0.08em]">
                {job.role}
              </div>
              <div class="item-country font-medium">{job.company}</div>
            </div>
            <div class="item-expanded">
              <div class="item-expanded-content">
                <div class="item-image">
                  <img src={job.imageUrl} alt={`${job.company} image`} />
                </div>
                <div class="expanded-details">
                  <div class="expanded-header">
                    <h3>{job.position}</h3>
                    <p>{job.subtitle}</p>
                    <div class="header-divider" />
                  </div>
                  <div class="expanded-content">
                    <div class="description-column">
                      <p>
                        A global digital experience design agency specializing
                        in strategic advisory, design, and marketing solutions.
                        Key achievements:
                      </p>
                      <ul>
                        {job.description.map((item) => (
                          <li>{item}</li>
                        ))}
                      </ul>
                    </div>
                    <div class="description-column">
                      <div class="description-column-inner">
                        <h4>Key Skills:</h4>
                        <ul>
                          {job.skills.map((skill) => (
                            <li>{skill}</li>
                          ))}
                        </ul>
                      </div>
                      <div class="description-column-inner">
                        <h4>Impact:</h4>
                        <ul>
                          {job.impact.map((impact) => (
                            <li>{impact}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
        ))
      }
    </ul>

    <!-- Experience Footer -->
    <ProfileButtons linkedInUrl={linkedInUrl} resumeUrl={resumeFilePath} />
  </div>
</section>

<style>
  /* Color Variables */
  :root {
    --color-background: #1a1a1a;
    --color-text-primary: #ffffff;
    --color-text-secondary: #a0a0a0;
    --color-divider: #333333;
    --color-expanded-bg: #f1efe5;
    --color-expanded-text: #333333;
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --transition-speed: 0.3s;
  }

  /* Item List */
  .item-list {
    list-style: none;
    width: 100%;
    padding: 0;
    margin-left: 0;
    margin-bottom: 80px;
  }

  /* List Item */
  .list-item {
    position: relative;
    width: 100%;
    overflow: visible;
    transition: background-color var(--transition-speed);
  }

  .list-item[aria-expanded='true'] {
    width: 100%;
  }

  .list-item:hover .item-main {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .list-item:focus {
    outline: none;
  }

  /* Item Main */
  .item-main {
    display: flex;
    align-items: center;
    margin-left: 350px;
    padding: var(--spacing-lg) var(--spacing-md);
    transition: background-color var(--transition-speed);
    width: calc(100% - 350px);
    border-bottom: 1px solid var(--color-divider);
    cursor: pointer;
  }

  .item-year {
    width: 15%;
    margin-left: 5px;
    color: var(--color-text-primary);
  }

  .item-model {
    width: 45%;
    /* line-height: 1.2; */
    padding-left: var(--spacing-lg);
    color: var(--color-text-primary);
  }

  .item-country {
    width: 40%;
    text-align: left;
    padding-left: var(--spacing-lg);
    color: var(--color-text-primary);
  }

  /* Expanded Item */
  .item-expanded {
    position: absolute;
    left: 0;
    width: 100%;
    display: flex;
    background-color: var(--color-expanded-bg);
    border-radius: 0;
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: all var(--transition-speed);
    z-index: 10;
  }

  .list-item[aria-expanded='true'] .item-expanded {
    position: relative;
    max-height: none;
    opacity: 1;
    transform: translateY(0);
  }

  .item-expanded-content {
    display: flex;
    width: 100%;
    padding: 0;
    min-height: 230px;
  }

  .item-image {
    width: 25%;
    height: 230px;
    max-width: 350px;
    overflow: hidden;
  }

  .item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .expanded-details {
    display: flex;
    flex-direction: column;
    width: 75%;
    padding: var(--spacing-lg);
  }

  .expanded-header {
    margin-bottom: var(--spacing-md);
  }

  .expanded-header h3 {
    font-size: 1.4rem;
    font-weight: 500;
    margin-bottom: var(--spacing-sm);
    color: var(--color-expanded-text);
  }

  .expanded-header p {
    color: var(--color-text-secondary);
    font-size: 0.9rem;
    margin-top: var(--spacing-xs);
  }

  .header-divider {
    height: 1px;
    background-color: #cccccc;
    margin: var(--spacing-md) 0;
    width: 100%;
  }

  .expanded-content {
    display: flex;
    color: var(--color-expanded-text);
  }

  .description-column {
    flex: 1;
    padding-right: var(--spacing-md);
  }

  .description-column-inner {
    width: 50%;
    padding-right: var(--spacing-md);
    float: inline-start;
  }

  /* Additional styles to maintain side-by-side layout */
  .description-column:nth-child(2) {
    display: flex;
    flex-wrap: wrap;
  }

  .description-column p {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
  }

  .expanded-details ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .expanded-details ul li {
    margin-bottom: var(--spacing-sm);
    position: relative;
    padding-left: 20px;
  }

  .expanded-details ul li::before {
    content: '•';
    position: absolute;
    left: 0;
    color: var(--color-text-secondary);
  }

  .expanded-details h4 {
    color: var(--color-expanded-text);
    font-size: 1.1rem;
    margin-bottom: var(--spacing-sm);
    font-weight: 500;
  }

  /* Responsive Adjustments */
  @media (max-width: 1280px) {
    .item-main {
      margin-left: 250px;
      width: calc(100% - 250px);
    }

    .item-year {
      width: 15%;
    }

    .item-model {
      width: 40%;
      font-size: 1.5rem;
    }

    .item-country {
      width: 45%;
    }
  }

  @media (max-width: 992px) {
    .item-main {
      margin-left: 150px;
      width: calc(100% - 150px);
    }

    .item-model {
      width: 50%;
      font-size: 1.4rem;
      padding-left: var(--spacing-md);
    }

    .item-country {
      width: 35%;
      padding-left: var(--spacing-md);
    }

    .item-image {
      display: none;
    }

    .expanded-details {
      width: 100%;
    }

    .item-expanded-content {
      flex-direction: column;
    }

    .expanded-content {
      flex-direction: column;
    }

    .description-column {
      width: 100%;
      padding-right: 0;
      margin-bottom: 1rem;
    }

    /* Keep skills and impact side by side */
    .description-column:nth-child(2) {
      display: flex;
      flex-wrap: wrap;
    }
  }

  @media (max-width: 768px) {
    /* Add margin to h2 on mobile */
    :global(.h2-heading) {
      margin-bottom: 1.5rem;
    }

    .item-main {
      flex-wrap: wrap;
      margin-left: 0;
      width: 100%;
      padding: var(--spacing-md);
    }

    .item-year {
      width: auto;
      margin-right: var(--spacing-md);
      text-align: left;
    }

    .item-model {
      width: 100%;
      order: -1;
      margin-bottom: var(--spacing-sm);
      font-size: 1.3rem;
      padding-left: 0;
    }

    .item-country {
      width: auto;
      padding-left: 0;
    }

    .list-item[aria-expanded='true'] .item-expanded {
      max-height: none;
    }

    .item-expanded-content {
      min-height: auto;
    }
  }

  @media (max-width: 576px) {
    .item-expanded {
      flex-direction: column;
    }

    .item-image,
    .expanded-details {
      width: 100%;
    }

    .item-main {
      padding: var(--spacing-sm);
    }

    .item-year,
    .item-country {
      font-size: 0.9rem;
    }

    .item-model {
      font-size: 1.2rem;
    }

    .description-column-inner {
      width: 100%;
      float: none;
      margin-bottom: var(--spacing-md);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const listItems = document.querySelectorAll('.list-item');
    const itemMains = document.querySelectorAll('.item-main');

    // Function to collapse all items except the one we want to keep expanded
    const collapseOtherItems = (currentItem) => {
      listItems.forEach((item) => {
        if (item !== currentItem) {
          item.setAttribute('aria-expanded', 'false');
        }
      });
    };

    // Add click handlers to item-main elements
    itemMains.forEach((itemMain) => {
      itemMain.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent event from bubbling to parent
        const parentItem = itemMain.closest('.list-item');
        const isExpanded = parentItem.getAttribute('aria-expanded') === 'true';

        // If clicking the same item-main that's already expanded, just collapse it
        if (isExpanded) {
          parentItem.setAttribute('aria-expanded', 'false');
        } else {
          // Collapse all other items and expand this one
          collapseOtherItems(parentItem);
          parentItem.setAttribute('aria-expanded', 'true');
        }
      });
    });

    // Handle keyboard interaction only on item-main elements
    itemMains.forEach((itemMain) => {
      itemMain.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          e.stopPropagation();
          const parentItem = itemMain.closest('.list-item');
          const isExpanded =
            parentItem.getAttribute('aria-expanded') === 'true';

          if (isExpanded) {
            parentItem.setAttribute('aria-expanded', 'false');
          } else {
            collapseOtherItems(parentItem);
            parentItem.setAttribute('aria-expanded', 'true');
          }
        }
      });
    });
  });
</script>
