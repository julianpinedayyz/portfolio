---
import Contact from './Contact.astro';
import Hero from './Hero.astro';
// Remove experiment imports
// import Pricing from '../../experiments/Pricing.astro';
// import StatsCards from '../../experiments/StatsCards.astro';
// import DualCards from '../../experiments/DualCards.astro';
// import Palette from '../../experiments/Palette.astro';
---

<!-- Fixed Toggle Button -->
<button
  id="sandbox-toggle"
  class="fixed right-4 bottom-4 z-50 flex items-center justify-center w-12 h-12 bg-[#AAC0AA] rounded-full shadow-lg hover:bg-opacity-90 transition-all focus:outline-none focus:ring-2 focus:ring-[#7DA1BF]"
  aria-expanded="false"
  aria-controls="sandbox-section"
>
  <span class="sr-only">Toggle UI Sandbox</span>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6 text-[#24272B]"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
    ></path>
  </svg>
</button>

<section
  id="sandbox-section"
  class="py-12 bg-white border-b border-gray-200 hidden"
>
  <div class="site-container">
    <h2 class="text-3xl font-bold mb-6 text-gray-800">UI Sandbox</h2>

    <!-- Tabs Navigation -->
    <div class="flex border-b border-gray-200 mb-8" role="tablist">
      <button
        id="tab-elements"
        class="px-4 py-2 font-medium text-gray-800 border-b-2 border-gray-800"
        role="tab"
        aria-selected="true"
        aria-controls="panel-elements"
      >
        UI Elements
      </button>
      <button
        id="tab-palette"
        class="px-4 py-2 font-medium text-gray-500 hover:text-gray-800"
        role="tab"
        aria-selected="false"
        aria-controls="panel-palette"
      >
        Color Palette
      </button>
      <button
        id="tab-stats"
        class="px-4 py-2 font-medium text-gray-500 hover:text-gray-800"
        role="tab"
        aria-selected="false"
        aria-controls="panel-stats"
      >
        Stats Cards
      </button>
      <button
        id="tab-inter-font"
        class="px-4 py-2 font-medium text-gray-500 hover:text-gray-800 border-b-2 border-transparent"
        role="tab"
        aria-selected="false"
        aria-controls="panel-inter-font"
      >
        Inter Font Styles
      </button>
    </div>

    <!-- UI Elements Tab Panel -->
    <div id="panel-elements" role="tabpanel" aria-labelledby="tab-elements">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Color Palette Section -->
        <div class="bg-white p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Color Palette
          </h3>
          <div class="space-y-3">
            <div class="flex items-center">
              <div class="w-12 h-12 bg-[#AAC0AA] mr-3"></div>
              <div>
                <div class="font-medium text-gray-800">Sage Green</div>
                <div class="text-sm text-gray-500">#AAC0AA</div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="w-12 h-12 bg-[#7DA1BF] mr-3"></div>
              <div>
                <div class="font-medium text-gray-800">Subtle Blue</div>
                <div class="text-sm text-gray-500">#7DA1BF</div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="w-12 h-12 bg-[#E6A57E] mr-3"></div>
              <div>
                <div class="font-medium text-gray-800">Terracotta</div>
                <div class="text-sm text-gray-500">#E6A57E</div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="w-12 h-12 bg-[#A63D40] mr-3"></div>
              <div>
                <div class="font-medium text-gray-800">Muted Red</div>
                <div class="text-sm text-gray-500">#A63D40</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Button Styles -->
        <div class="bg-[#AAC0AA] p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-[#24272B]">
            Button Styles
          </h3>
          <div class="space-y-4">
            <button
              class="px-5 py-2 bg-[#E6A57E] text-[#24272B] font-medium hover:bg-opacity-90 transition-all"
            >
              Primary Button
            </button>

            <button
              class="px-4 py-2 border border-[#A63D40] text-[#24272B] text-sm hover:bg-[#E8E2CB] transition-all block"
            >
              Secondary Button
            </button>

            <button
              class="w-full flex items-center justify-between border border-[#A63D40] overflow-hidden"
            >
              <span class="px-4 py-2 text-[#24272B]">Button with Icon</span>
              <div
                class="h-10 w-10 bg-[#A63D40] border-l border-[#A63D40] flex items-center justify-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 text-white"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                </svg>
              </div>
            </button>

            <button
              class="w-10 h-10 bg-[#7DA1BF] flex items-center justify-center hover:bg-opacity-90 transition-all"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-[#24272B]"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                  clip-rule="evenodd"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Typography -->
        <div class="bg-[#E8E2CB] p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-[#24272B]">Typography</h3>
          <div class="space-y-3">
            <div>
              <div class="text-xs text-[#A63D40]">Heading 1</div>
              <div class="text-4xl font-bold text-[#24272B]">
                The quick brown fox
              </div>
            </div>
            <div>
              <div class="text-xs text-[#A63D40]">Heading 2</div>
              <div class="text-3xl font-bold text-[#24272B]">
                The quick brown fox
              </div>
            </div>
            <div>
              <div class="text-xs text-[#A63D40]">Heading 3</div>
              <div class="text-2xl font-semibold text-[#24272B]">
                The quick brown fox
              </div>
            </div>
            <div>
              <div class="text-xs text-[#A63D40]">Body</div>
              <div class="text-base text-[#24272B]">
                The quick brown fox jumps over the lazy dog.
              </div>
            </div>
            <div>
              <div class="text-xs text-[#A63D40]">Small</div>
              <div class="text-sm text-[#24272B]">
                The quick brown fox jumps over the lazy dog.
              </div>
            </div>
          </div>
        </div>

        <!-- Card Styles -->
        <div class="bg-[#AAC0AA] p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-[#24272B]">Card Styles</h3>
          <div class="space-y-4">
            <div class="bg-[#E6A57E] p-4">
              <h4 class="font-medium text-[#24272B]">Terracotta Card</h4>
              <p class="text-sm text-[#24272B] mt-1">
                With square corners and padding.
              </p>
            </div>

            <div class="bg-[#A63D40] p-4">
              <h4 class="font-medium text-white">Red Card</h4>
              <p class="text-sm text-white mt-1">
                With square corners and padding.
              </p>
            </div>

            <div class="bg-[#E8E2CB] p-4 border border-[#24272B] shadow-sm">
              <h4 class="font-medium text-[#24272B]">Bordered Card</h4>
              <p class="text-sm text-[#24272B] mt-1">
                With border and subtle shadow.
              </p>
            </div>
          </div>
        </div>

        <!-- Form Elements -->
        <div class="bg-white p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Form Elements
          </h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Input Field</label
              >
              <input
                type="text"
                placeholder="Type something..."
                class="w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-[#E6A57E] focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Select Dropdown</label
              >
              <select
                class="w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-[#E6A57E] focus:border-transparent"
              >
                <option>Option 1</option>
                <option>Option 2</option>
                <option>Option 3</option>
              </select>
            </div>

            <div class="flex items-center">
              <input
                type="checkbox"
                class="h-4 w-4 text-[#7DA1BF] focus:ring-[#7DA1BF] border-gray-300"
              />
              <label class="ml-2 block text-sm text-gray-700">Checkbox</label>
            </div>

            <div class="flex items-center">
              <input
                type="radio"
                class="h-4 w-4 text-[#A63D40] focus:ring-[#A63D40] border-gray-300"
              />
              <label class="ml-2 block text-sm text-gray-700"
                >Radio Button</label
              >
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Textarea</label
              >
              <textarea
                rows="3"
                placeholder="Write a description..."
                class="w-full px-4 py-2 border border-gray-300 focus:ring-2 focus:ring-[#E6A57E] focus:border-transparent"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Navigation Elements -->
        <div class="bg-[#E8E2CB] p-6 shadow-sm border border-gray-200">
          <h3 class="text-xl font-semibold mb-4 text-[#24272B]">Navigation</h3>
          <div class="space-y-4">
            <div class="flex space-x-4 border-b border-[#24272B]">
              <div class="text-[#A63D40] border-b-2 border-[#A63D40] py-2">
                Tab 1
              </div>
              <div class="text-[#24272B] py-2">Tab 2</div>
              <div class="text-[#24272B] py-2">Tab 3</div>
            </div>

            <div
              class="flex items-center justify-between py-2 border-b border-[#24272B]"
            >
              <div class="text-[#24272B] font-medium">Dropdown Menu</div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-[#24272B]"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                  clip-rule="evenodd"></path>
              </svg>
            </div>

            <div class="flex space-x-3">
              <span
                class="px-3 py-1 bg-[#A63D40] text-white text-sm rounded-full"
              >
                Tag 1
              </span>
              <span
                class="px-3 py-1 bg-[#7DA1BF] text-white text-sm rounded-full"
              >
                Tag 2
              </span>
              <span
                class="px-3 py-1 bg-[#E6A57E] text-[#24272B] text-sm rounded-full"
              >
                Tag 3
              </span>
            </div>

            <div class="flex items-center justify-between">
              <div class="flex space-x-1">
                <a
                  href="#"
                  class="w-8 h-8 flex items-center justify-center border border-[#24272B] text-[#24272B]"
                  >1</a
                >
                <a
                  href="#"
                  class="w-8 h-8 flex items-center justify-center border border-[#24272B] bg-[#24272B] text-white"
                  >2</a
                >
                <a
                  href="#"
                  class="w-8 h-8 flex items-center justify-center border border-[#24272B] text-[#24272B]"
                  >3</a
                >
              </div>
              <a href="#" class="text-[#A63D40] text-sm">View All</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Palette Tab Panel -->
    <div
      id="panel-palette"
      role="tabpanel"
      aria-labelledby="tab-palette"
      class="hidden"
    >
      <!-- Custom light-background wrapper for Palette component -->
      <div class="bg-white -mx-4 p-4 rounded-lg">
        <div class="text-gray-800 mb-8">
          <p class="max-w-3xl">
            The full color palette showcase is embedded below. Click on any
            color to copy its hex code. The palettes are inspired by Bauhaus
            design principles.
          </p>
        </div>
        <div class="rounded-lg overflow-hidden">
          {/* Remove unused experiment component */}
          {/* <Palette /> */}
          <p class="p-4 text-gray-500 italic">Palette component removed.</p>
        </div>
      </div>
    </div>

    <!-- Stats Cards Tab Panel -->
    <div
      id="panel-stats"
      role="tabpanel"
      aria-labelledby="tab-stats"
      class="hidden"
    >
      <!-- Custom light-background wrapper for StatsCards component -->
      <div class="bg-white -mx-4 p-4 rounded-lg">
        <div class="text-gray-800 mb-8">
          <p class="max-w-3xl">
            These stats cards showcase different data visualization styles.
            They're designed to present key metrics in an engaging format.
          </p>
        </div>
        <div class="rounded-lg overflow-hidden">
          {/* Remove unused experiment component */}
          {/* <StatsCards /> */}
          <p class="p-4 text-gray-500 italic">StatsCards component removed.</p>
        </div>
      </div>
    </div>

    <!-- Inter Font Styles Tab Panel -->
    <div
      id="panel-inter-font"
      role="tabpanel"
      aria-labelledby="tab-inter-font"
      class="hidden"
    >
      <div class="bg-white p-6 shadow-sm border border-gray-200 space-y-8">
        <div>
          <h3 class="text-xl font-semibold mb-4 text-gray-800">
            Inter Font Styles
          </h3>
          <p class="mb-6 text-gray-600">
            Examples of the Inter typeface weights and italic styles. Loaded via <code
              class="bg-gray-100 px-1 py-0.5 rounded text-sm"
              >@import url('https://rsms.me/inter/inter.css');</code
            >
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
          <!-- Regular Weights -->
          <div class="space-y-4">
            <h4 class="text-lg font-medium text-gray-700 border-b pb-1">
              Regular Weights
            </h4>
            <p class="font-thin">Thin 100 - Salient gazelle eyes</p>
            <p class="font-extralight">ExtraLight 200 - Internationalization</p>
            <p class="font-light">Light 300 - Millimeter waves</p>
            <p class="font-normal">Regular 400 - Assimilation engine</p>
            <p class="font-medium">Medium 500 - Botanica Francisco</p>
            <p class="font-semibold">SemiBold 600 - Spontaneous apes</p>
            <p class="font-bold">Bold 700 - 15 Mango Avenue</p>
            <p class="font-extrabold">ExtraBold 800 - Comedy Morning</p>
            <p class="font-black">Black 900 - Hamburgefonstiv</p>
          </div>

          <!-- Italic Weights -->
          <div class="space-y-4">
            <h4 class="text-lg font-medium text-gray-700 border-b pb-1">
              Italic Weights
            </h4>
            <p class="font-thin italic">Thin Italic 100 - Inorganic compound</p>
            <p class="font-extralight italic">
              ExtraLight Italic 200 - Extravaganza Lime
            </p>
            <p class="font-light italic">
              Light Italic 300 - Rectangular ellipse
            </p>
            <p class="font-normal italic">
              Regular Italic 400 - 3 hours till midnight
            </p>
            <p class="font-medium italic">
              Medium Italic 500 - Artificial Intelligence
            </p>
            <p class="font-semibold italic">
              SemiBold Italic 600 - Sulfur hexafluoride
            </p>
            <p class="font-bold italic">
              Bold Italic 700 - Hospital helicopter
            </p>
            <p class="font-extrabold italic">
              ExtraBold Italic 800 - Encyclopedia Abc
            </p>
            <p class="font-black italic">Black Italic 900 - United Martians</p>
          </div>
        </div>

        <!-- Letter Spacing (Tracking) -->
        <div class="pt-6 border-t">
          <h4 class="text-lg font-medium text-gray-700 mb-4">
            Letter Spacing (Tracking)
          </h4>
          <div class="space-y-3">
            <p class="tracking-tighter">Tracking Tighter (-0.05em)</p>
            <p class="tracking-tight">Tracking Tight (-0.025em)</p>
            <p class="tracking-normal">Tracking Normal (0em)</p>
            <p class="tracking-wide">Tracking Wide (0.025em)</p>
            <p class="tracking-wider">Tracking Wider (0.05em)</p>
            <p class="tracking-widest">Tracking Widest (0.1em)</p>
          </div>
        </div>

        <!-- Line Height (Leading) -->
        <div class="pt-6 border-t">
          <h4 class="text-lg font-medium text-gray-700 mb-4">
            Line Height (Leading)
          </h4>
          <div class="space-y-4 max-w-md">
            <p class="leading-none">
              Leading None (1): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
            <p class="leading-tight">
              Leading Tight (1.25): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
            <p class="leading-snug">
              Leading Snug (1.375): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
            <p class="leading-normal">
              Leading Normal (1.5): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
            <p class="leading-relaxed">
              Leading Relaxed (1.625): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
            <p class="leading-loose">
              Leading Loose (2): Lorem ipsum dolor sit amet, consectetur
              adipiscing elit. Sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua.
            </p>
          </div>
        </div>

        <!-- Circled / Squared Characters -->
        <div class="pt-6 border-t">
          <h4 class="text-lg font-medium text-gray-700 mb-4">
            Circled / Squared Characters
          </h4>
          <p class="text-gray-600 mb-3">
            Inter uses standard Unicode characters for circled or squared
            numbers/letters rather than CSS classes or OpenType features. You
            can copy and paste these directly:
          </p>
          <div class="flex flex-wrap gap-4 text-xl">
            <span>① ② ③ ④ ⑤</span>
            <span>⑴ ⑵ ⑶ ⑷ ⑸</span>
            <span>⓵ ⓶ ⓷ ⓸ ⓹</span>
            <span>Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ</span>
            <span>🅐 🅑 🅒 🅓 🅔</span>
          </div>
          <p class="text-sm text-gray-500 mt-2">
            Note: Display depends on system/browser font support for these
            Unicode characters.
          </p>
        </div>

        <!-- Example Text Block -->
        <div class="mt-8 pt-4 border-t">
          <h4 class="text-lg font-medium text-gray-700 mb-2">
            Example Text (Regular 400)
          </h4>
          <p class="font-normal text-gray-800 leading-relaxed">
            One of the most famous lighthouses of antiquity, as I have already
            pointed out, was the pharos of Alexandria, which ancient writers
            included among the Seven Wonders of the World. It might naturally be
            supposed that the founder of so remarkable a monument of
            architectural skill would be well known; yet while Strabo and Pliny,
            Eusebius, Suidas, and Lucian ascribe its erection to Ptolemæus
            Philadelphus, the wisest and most benevolent of the Ptolemean kings
            of Egypt, by Tzetzes and Ammianus Marcellinus the honour is given to
            Cleopatra; <em
              >and other authorities even attribute it to Alexander the Great.</em
            >
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Toggle Sandbox Visibility with smooth transition
    const toggleButton = document.getElementById('sandbox-toggle');
    const sandboxSection = document.getElementById('sandbox-section');

    // Add transition classes to sandbox section
    sandboxSection.classList.add(
      'transition-all',
      'duration-300',
      'ease-in-out',
    );

    // Function to update button icon based on state
    const updateToggleButton = (isVisible) => {
      toggleButton.setAttribute('aria-expanded', isVisible ? 'true' : 'false');

      // Apply transition before changing visibility
      if (isVisible) {
        sandboxSection.style.opacity = '0';
        sandboxSection.classList.remove('hidden');
        // Force reflow to ensure transition applies correctly
        void sandboxSection.offsetWidth;
        sandboxSection.style.opacity = '1';
      } else {
        sandboxSection.style.opacity = '0';
        setTimeout(() => {
          sandboxSection.classList.add('hidden');
        }, 300); // Match transition duration
      }

      // Update button icon
      toggleButton.innerHTML = isVisible
        ? `<span class="sr-only">Hide UI Sandbox</span>
           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#24272B] transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
           </svg>`
        : `<span class="sr-only">Show UI Sandbox</span>
           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#24272B] transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
           </svg>`;
    };

    // Tab System Enhancement
    const tabs = document.querySelectorAll('[role="tab"]');
    const panels = document.querySelectorAll('[role="tabpanel"]');

    // Function to switch tabs
    const switchTab = (oldTab, newTab) => {
      newTab.focus();
      newTab.setAttribute('aria-selected', 'true');
      oldTab.setAttribute('aria-selected', 'false');

      // Update tab styles
      oldTab.classList.remove('text-gray-800', 'border-gray-800');
      oldTab.classList.add('text-gray-500', 'hover:text-gray-800');
      newTab.classList.remove('text-gray-500', 'hover:text-gray-800');
      newTab.classList.add('text-gray-800', 'border-gray-800');

      const newPanelId = newTab.getAttribute('aria-controls');
      const newPanel = document.getElementById(newPanelId);

      // Hide all panels initially with transition
      panels.forEach((panel) => {
        panel.style.opacity = '0';
        panel.classList.add(
          'hidden',
          'transition-opacity',
          'duration-200',
          'ease-in-out',
        );
      });

      // Show the new panel with transition
      if (newPanel) {
        newPanel.classList.remove('hidden');
        // Force reflow before changing opacity for transition
        void newPanel.offsetWidth;
        newPanel.style.opacity = '1';
      }
    };

    // Add click events to tabs
    tabs.forEach((tab) => {
      tab.addEventListener('click', (e) => {
        const currentTab = document.querySelector(
          '[role="tab"][aria-selected="true"]',
        );
        if (e.currentTarget !== currentTab) {
          switchTab(currentTab, e.currentTarget);
        }
      });

      // Add keyboard navigation
      tab.addEventListener('keydown', (e) => {
        let index = Array.from(tabs).indexOf(e.currentTarget);
        let newIndex;

        if (e.key === 'ArrowRight') {
          newIndex = (index + 1) % tabs.length;
        } else if (e.key === 'ArrowLeft') {
          newIndex = (index - 1 + tabs.length) % tabs.length;
        } else if (e.key === 'Home') {
          newIndex = 0;
        } else if (e.key === 'End') {
          newIndex = tabs.length - 1;
        } else {
          return; // Ignore other keys
        }

        const currentTab = document.querySelector(
          '[role="tab"][aria-selected="true"]',
        );
        switchTab(currentTab, tabs[newIndex]);
        e.preventDefault(); // Prevent page scroll on arrow keys
      });
    });

    // Function to save preference
    const saveSandboxPreference = (isVisible) => {
      if (typeof localStorage !== 'undefined') {
        localStorage.setItem('sandboxVisible', isVisible ? 'true' : 'false');
      }
    };

    // Function to load preference
    const loadSandboxPreference = () => {
      if (typeof localStorage !== 'undefined') {
        const isVisible = localStorage.getItem('sandboxVisible') === 'true';

        if (isVisible) {
          sandboxSection.classList.remove('hidden');
          // Ensure initial opacity is set for transition
          sandboxSection.style.opacity = '1';
        } else {
          sandboxSection.classList.add('hidden');
          sandboxSection.style.opacity = '0';
        }

        updateToggleButton(isVisible);
        return isVisible;
      }
      // Default to hidden if localStorage is not available or preference not set
      sandboxSection.classList.add('hidden');
      sandboxSection.style.opacity = '0';
      updateToggleButton(false);
      return false;
    };

    // Toggle functionality
    toggleButton.addEventListener('click', () => {
      const isCurrentlyVisible = !sandboxSection.classList.contains('hidden');
      const newVisibility = !isCurrentlyVisible;

      updateToggleButton(newVisibility); // Update button first
      saveSandboxPreference(newVisibility); // Save preference

      // If opening, scroll into view after transition starts
      if (newVisibility) {
        sandboxSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });

    // Initialize with saved preference
    loadSandboxPreference();

    // Initialize the first tab (UI Elements) as active
    const firstTab = document.getElementById('tab-elements');
    const firstPanel = document.getElementById('panel-elements');
    if (firstTab && firstPanel) {
      firstTab.setAttribute('aria-selected', 'true');
      firstPanel.classList.remove('hidden');
      firstPanel.style.opacity = '1'; // Ensure the first panel is visible
    }
  });
</script>
